(function(){$(function(){function t(n){n?i.jtable("reload"):i.jtable("load",{filter:$("#TenantsTableFilter").val()})}function s(n){abp.message.confirm(app.localize("TenantDeleteWarningMessage",n.tenancyName),function(i){i&&r.deleteTenant({id:n.id}).done(function(){t();abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var i=$("#TenantsTable"),r=abp.services.app.tenant,n={create:abp.auth.hasPermission("Pages.Tenants.Create"),edit:abp.auth.hasPermission("Pages.Tenants.Edit"),changeFeatures:abp.auth.hasPermission("Pages.Tenants.ChangeFeatures"),impersonation:abp.auth.hasPermission("Pages.Tenants.Impersonation"),"delete":abp.auth.hasPermission("Pages.Tenants.Delete")},u=new app.ModalManager({viewUrl:abp.appPath+"Admin/Tenants/CreateModal",scriptUrl:abp.appPath+"view-resources/Areas/Admin/Views/Tenants/_CreateModal.js",modalClass:"CreateTenantModal"}),f=new app.ModalManager({viewUrl:abp.appPath+"Admin/Tenants/EditModal",scriptUrl:abp.appPath+"view-resources/Areas/Admin/Views/Tenants/_EditModal.js",modalClass:"EditTenantModal"}),e=new app.ModalManager({viewUrl:abp.appPath+"Admin/Tenants/FeaturesModal",scriptUrl:abp.appPath+"view-resources/Areas/Admin/Views/Tenants/_FeaturesModal.js",modalClass:"TenantFeaturesModal"}),o=app.modals.LookupModal.create({title:app.localize("SelectAUser"),serviceMethod:abp.services.app.commonLookup.findUsers});i.jtable({title:app.localize("Tenants"),paging:!0,sorting:!0,multiSorting:!0,actions:{listAction:{method:r.getTenants}},fields:{id:{key:!0,list:!1},actions:{title:app.localize("Actions"),width:"15%",sorting:!1,list:n.edit||n.delete,display:function(t){var i=$("<span><\/span>");return n.impersonation&&$('<button class="btn btn-default btn-xs" title="'+app.localize("LoginAsThisTenant")+'"><i class="fa fa-sign-in"><\/i><\/button>').appendTo(i).click(function(){o.open({extraFilters:{tenantId:t.record.id},title:app.localize("SelectAUser")},function(n){abp.ajax({url:abp.appPath+"Account/Impersonate",data:JSON.stringify({tenantId:t.record.id,userId:parseInt(n.value)})})})}),n.edit&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Edit")+'"><i class="fa fa-edit"><\/i><\/button>').appendTo(i).click(function(){f.open({id:t.record.id})}),n.changeFeatures&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Features")+'"><i class="fa fa-list"><\/i><\/button>').appendTo(i).click(function(){e.open({id:t.record.id})}),n.delete&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Delete")+'"><i class="fa fa-trash-o"><\/i><\/button>').appendTo(i).click(function(){s(t.record)}),i}},tenancyName:{title:app.localize("TenancyCodeName"),width:"18%"},name:{title:app.localize("Name"),width:"20%"},editionDisplayName:{title:app.localize("Edition"),width:"18%"},isActive:{title:app.localize("Active"),width:"9%",display:function(n){return n.record.isActive?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},creationTime:{title:app.localize("CreationTime"),width:"20%",display:function(n){return moment(n.record.creationTime).format("L")}}}});$("#CreateNewTenantButton").click(function(){u.open()});$("#GetTenantsButton").click(function(n){n.preventDefault();t()});abp.event.on("app.editTenantModalSaved",function(){t(!0)});abp.event.on("app.createTenantModalSaved",function(){t(!0)});t();$("#TenantsTableFilter").focus()})})();