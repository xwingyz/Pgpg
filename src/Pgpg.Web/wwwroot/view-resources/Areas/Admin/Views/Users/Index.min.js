(function(){$(function(){function i(n){n?r.jtable("reload"):r.jtable("load",{filter:$("#UsersTableFilter").val(),permission:$("#PermissionSelectionCombo").val(),role:$("#RoleSelectionCombo").val()})}function e(t){if(t.userName==app.consts.userManagement.defaultAdminUserName){abp.message.warn(app.localize("{0}UserCannotBeDeleted",app.consts.userManagement.defaultAdminUserName));return}abp.message.confirm(app.localize("UserDeleteWarningMessage",t.userName),function(r){r&&n.deleteUser({id:t.id}).done(function(){i(!0);abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var r=$("#UsersTable"),n=abp.services.app.user,t={create:abp.auth.hasPermission("Pages.Administration.Users.Create"),edit:abp.auth.hasPermission("Pages.Administration.Users.Edit"),changePermissions:abp.auth.hasPermission("Pages.Administration.Users.ChangePermissions"),impersonation:abp.auth.hasPermission("Pages.Administration.Users.Impersonation"),"delete":abp.auth.hasPermission("Pages.Administration.Users.Delete")},u=new app.ModalManager({viewUrl:abp.appPath+"Admin/Users/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/Admin/Views/Users/_CreateOrEditModal.js",modalClass:"CreateOrEditUserModal"}),f=new app.ModalManager({viewUrl:abp.appPath+"Admin/Users/PermissionsModal",scriptUrl:abp.appPath+"view-resources/Areas/Admin/Views/Users/_PermissionsModal.js",modalClass:"UserPermissionsModal"});r.jtable({title:app.localize("Users"),paging:!0,sorting:!0,multiSorting:!0,actions:{listAction:{method:n.getUsers}},fields:{id:{key:!0,list:!1},actions:{title:app.localize("Actions"),width:"15%",sorting:!1,display:function(i){var r=$("<span><\/span>");return t.impersonation&&i.record.id!=abp.session.userId&&$('<button class="btn btn-default btn-xs" title="'+app.localize("LoginAsThisUser")+'"><i class="fa fa-sign-in"><\/i><\/button>').appendTo(r).click(function(){abp.ajax({url:abp.appPath+"Account/Impersonate",data:JSON.stringify({tenantId:abp.session.tenantId,userId:i.record.id})})}),t.edit&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Edit")+'"><i class="fa fa-edit"><\/i><\/button>').appendTo(r).click(function(){u.open({id:i.record.id})}),t.changePermissions&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Permissions")+'"><i class="fa fa-list"><\/i><\/button>').appendTo(r).click(function(){f.open({id:i.record.id})}),$('<button class="btn btn-default btn-xs" title="'+app.localize("Unlock")+'"><i class="fa fa-unlock"><\/i><\/button>').appendTo(r).click(function(){n.unlockUser({id:i.record.id}).done(function(){abp.notify.success(app.localize("UnlockedTheUser",i.record.userName))})}),t.delete&&$('<button class="btn btn-default btn-xs" title="'+app.localize("Delete")+'"><i class="fa fa-trash-o"><\/i><\/button>').appendTo(r).click(function(){e(i.record)}),r}},userName:{title:app.localize("UserName"),width:"9%"},name:{title:app.localize("Name"),width:"10%"},surname:{title:app.localize("Surname"),width:"10%"},roles:{title:app.localize("Roles"),width:"12%",sorting:!1,display:function(n){for(var t="",i=0;i<n.record.roles.length;i++)t.length&&(t=t+", "),t=t+n.record.roles[i].roleName;return t}},emailAddress:{title:app.localize("EmailAddress"),width:"15%"},isEmailConfirmed:{title:app.localize("EmailConfirm"),width:"6%",display:function(n){return n.record.isEmailConfirmed?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},isActive:{title:app.localize("Active"),width:"6%",display:function(n){return n.record.isActive?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},lastLoginTime:{title:app.localize("LastLoginTime"),width:"7%",display:function(n){return n.record.lastLoginTime?moment(n.record.lastLoginTime).format("L"):"-"}},creationTime:{title:app.localize("CreationTime"),width:"7%",display:function(n){return moment(n.record.creationTime).format("L")}}}});$("#ShowAdvancedFiltersSpan").click(function(){$("#ShowAdvancedFiltersSpan").hide();$("#HideAdvancedFiltersSpan").show();$("#AdvacedAuditFiltersArea").slideDown()});$("#HideAdvancedFiltersSpan").click(function(){$("#HideAdvancedFiltersSpan").hide();$("#ShowAdvancedFiltersSpan").show();$("#AdvacedAuditFiltersArea").slideUp()});$("#CreateNewUserButton").click(function(){u.open()});$("#ExportUsersToExcelButton").click(function(){n.getUsersToExcel({}).done(function(n){app.downloadTempFile(n)})});$("#GetUsersButton, #RefreshUserListButton").click(function(n){n.preventDefault();i()});abp.event.on("app.createOrEditUserModalSaved",function(){i(!0)});i();$("#UsersTableFilter").focus()})})();
